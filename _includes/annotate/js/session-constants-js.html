<script>
  function set_constants() {
    console.log("running set constants");
    var static_title = "{{site.title}}";
    
    // Only set the title if dd_title doesn't exist in session storage yet
    // The dd-items.js will handle setting titles when CSV loads
    if (!sessionStorage.getItem("dd_title")) {
      var dd_title = static_title;
      console.log("No session title available yet, using static title temporarily:", static_title);
      
      // Only update UI if not updated by dd-items.js already
      if (document.getElementById("play_title")) {
        document.getElementById("play_title").innerHTML = dd_title;
      }
      
      {% if page.layout == "home" %}
      if (document.getElementById("marquee_title")) {
        document.getElementById("marquee_title").innerHTML = dd_title;
      }
      {% endif %}
      
      {% unless page.layout == "home-cover" %}
      if (document.getElementById("offcanvasLabel")) {
        document.getElementById("offcanvasLabel").innerHTML = dd_title;
      }
      {% endunless %}
    } else {
      console.log("Session title already exists, skipping static title");
    }
    
    // Handle scenes - but only if dd-items.js hasn't done it already
    if (!document.getElementById("scenesNavDropdown").innerHTML) {
      var static_scenes = '["1.1","1.2","2.1","2.2","3.1","3.2","4.1","4.2","5.1"]';
      var scenesNav = '';
      
      var dd_scenes_nav = sessionStorage.getItem("dd_scenes_store") || static_scenes;
      
      try {
        var dd_scenes = JSON.parse(dd_scenes_nav);
        for (var i = 0, len = dd_scenes.length; i < len; i++) {
          var ref_url = "{{ '/?scene=' | relative_url }}";
          var act = dd_scenes[i].split('.')[0];
          var scene = dd_scenes[i].split('.')[1];
          console.log(dd_scenes[i] + "-- Act" + act + " scene " + scene);
          var sceneClass = 'act' + act + 'scene' + scene;
          scenesNav += '<li class="dropdown-item"><a class="link-dark rounded " href="'+ ref_url +'act' + act + 'scene' + scene +'">Act ' + act + ', Scene ' + scene +'</a></li>';
        }
        
        if (document.getElementById("scenesNavDropdown")) {
          document.getElementById("scenesNavDropdown").innerHTML = scenesNav;
        }
      } catch (e) {
        console.error("Error parsing scenes:", e);
      }
    }
  }
  
  // Add this code to ensure the function is called when the DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    set_constants();
  });
</script>