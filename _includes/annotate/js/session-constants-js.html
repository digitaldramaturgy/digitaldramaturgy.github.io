<script>
  function set_constants() {
    console.log("running set constants");
    var static_title = "{{site.title}}";
    
    // Only set the title if dd_title doesn't exist in session storage yet
    // The dd-items.js will handle setting titles when CSV loads
    if (!sessionStorage.getItem("dd_title")) {
      var dd_title = static_title;
      console.log("No session title available yet, using static title temporarily:", static_title);
      
      // Only update UI if not updated by dd-items.js already
      if (document.getElementById("play_title")) {
        document.getElementById("play_title").innerHTML = dd_title;
      }
      
      {% if page.layout == "home" %}
      if (document.getElementById("marquee_title")) {
        document.getElementById("marquee_title").innerHTML = dd_title;
      }
      {% endif %}
      
      {% unless page.layout == "home-cover" %}
      if (document.getElementById("offcanvasLabel")) {
        document.getElementById("offcanvasLabel").innerHTML = dd_title;
      }
      {% endunless %}
    } else {
      console.log("Session title already exists, using stored title");
      
      // Get title and author from session storage
      var dd_title = sessionStorage.getItem("dd_title");
      var dd_author = sessionStorage.getItem("dd_author");
      
      // Update UI with title and author if available
      if (document.getElementById("play_title")) {
        document.getElementById("play_title").innerHTML = dd_title;
        
        // Add author if available, in smaller font
        if (dd_author && dd_author.trim() !== "") {
          const authorElement = document.createElement("div");
          authorElement.id = "play_author";
          authorElement.className = "play-author";
          authorElement.style.fontSize = "0.7em";
          authorElement.style.marginTop = "5px";
          authorElement.innerHTML = dd_author;
          
          // Check if author element already exists
          if (!document.getElementById("play_author")) {
            document.getElementById("play_title").parentNode.insertBefore(
              authorElement,
              document.getElementById("play_title").nextSibling
            );
          } else {
            document.getElementById("play_author").innerHTML = dd_author;
          }
        }
      }
      
      {% if page.layout == "home" %}
      if (document.getElementById("marquee_title")) {
        document.getElementById("marquee_title").innerHTML = dd_title;
        
        // Add author to marquee if available, in smaller font
        if (dd_author && dd_author.trim() !== "") {
          const marqueAuthorElement = document.createElement("div");
          marqueAuthorElement.id = "marquee_author";
          marqueAuthorElement.className = "marquee-author";
          marqueAuthorElement.style.fontSize = "0.7em";
          marqueAuthorElement.style.marginTop = "5px";
          marqueAuthorElement.innerHTML = dd_author;
          
          // Check if author element already exists
          if (!document.getElementById("marquee_author")) {
            document.getElementById("marquee_title").parentNode.insertBefore(
              marqueAuthorElement,
              document.getElementById("marquee_title").nextSibling
            );
          } else {
            document.getElementById("marquee_author").innerHTML = dd_author;
          }
        }
      }
      {% endif %}
      
      {% unless page.layout == "home-cover" %}
      if (document.getElementById("offcanvasLabel")) {
        document.getElementById("offcanvasLabel").innerHTML = dd_title;
        
        // Add author to offcanvas if available, in smaller font
        if (dd_author && dd_author.trim() !== "") {
          const offcanvasAuthorElement = document.createElement("div");
          offcanvasAuthorElement.id = "offcanvas_author";
          offcanvasAuthorElement.className = "offcanvas-author";
          offcanvasAuthorElement.style.fontSize = "0.7em";
          offcanvasAuthorElement.style.marginTop = "5px";
          offcanvasAuthorElement.innerHTML = dd_author;
          
          // Check if author element already exists
          if (!document.getElementById("offcanvas_author")) {
            document.getElementById("offcanvasLabel").parentNode.insertBefore(
              offcanvasAuthorElement,
              document.getElementById("offcanvasLabel").nextSibling
            );
          } else {
            document.getElementById("offcanvas_author").innerHTML = dd_author;
          }
        }
      }
      {% endunless %}
    }
    
    // Handle scenes - but only if dd-items.js hasn't done it already
    if (!document.getElementById("scenesNavDropdown").innerHTML) {
      var static_scenes = '["1.1","1.2","2.1","2.2","3.1","3.2","4.1","4.2","5.1"]';
      var scenesNav = '';
      
      var dd_scenes_nav = sessionStorage.getItem("dd_scenes_store") || static_scenes;
      
      try {
        var dd_scenes = JSON.parse(dd_scenes_nav);
        for (var i = 0, len = dd_scenes.length; i < len; i++) {
          var ref_url = "{{ '/?scene=' | relative_url }}";
          var act = dd_scenes[i].split('.')[0];
          var scene = dd_scenes[i].split('.')[1];
          console.log(dd_scenes[i] + "-- Act" + act + " scene " + scene);
          var sceneClass = 'act' + act + 'scene' + scene;
          scenesNav += '<li class="dropdown-item"><a class="link-dark rounded " href="'+ ref_url +'act' + act + 'scene' + scene +'">Act ' + act + ', Scene ' + scene +'</a></li>';
        }
        
        if (document.getElementById("scenesNavDropdown")) {
          document.getElementById("scenesNavDropdown").innerHTML = scenesNav;
        }
      } catch (e) {
        console.error("Error parsing scenes:", e);
      }
    }
  }
  
  // Add this code to ensure the function is called when the DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    set_constants();
  });
</script>